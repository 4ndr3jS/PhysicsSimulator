<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase Changes - Physics Simulator</title>
    <link rel="stylesheet" href="simulations.css">
</head>
<body>
    <nav>
        <a href="index.html">Physics Simulator</a>
        <ul>
            <a href="../index.html">Home</a>
            <a href="../simulations.html">Simulations</a>
            <a href="../guide.html">Guide</a>
            <a href="../theory.html">Theory</a>
            <a href="../learn.html">Learn Physics</a>
        </ul>
    </nav>

    <div class="sim-container">
        <div class="sim-header">
            <h1>üå°Ô∏è Phase Changes</h1>
            <p>Explore the transitions between solid, liquid, and gas states of matter</p>
            <p class="sim-subtitle">Difficulty: <span class="sim-badge sim-badge-medium">‚óè Medium</span></p>
            <div class="phase-indicator" id="phaseIndicator">SOLID</div>
        </div>

        <div class="sim-layout">
            <div class="sim-canvas-section">
                <div class="sim-canvas-wrapper">
                    <canvas id="simCanvas" class="sim-canvas" width="800" height="500"></canvas>
                    
                    <div class="sim-controls">
                        <button class="sim-btn sim-btn-primary" onclick="startSimulation()">‚ñ∂Ô∏è Start</button>
                        <button class="sim-btn sim-btn-secondary" onclick="pauseSimulation()" id="pauseBtn">‚è∏Ô∏è Pause</button>
                        <button class="sim-btn sim-btn-secondary" onclick="resetSimulation()">üîÑ Reset</button>
                    </div>
                </div>

                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">üìê</span>
                        <span>Phase Transitions</span>
                    </div>
                    <div class="sim-formula">
                        <div class="sim-formula-equation">Melting: Solid ‚Üí Liquid</div>
                        <div class="sim-formula-description">Energy increases, bonds weaken (0¬∞C for water)</div>
                    </div>
                    <div class="sim-formula">
                        <div class="sim-formula-equation">Vaporization: Liquid ‚Üí Gas</div>
                        <div class="sim-formula-description">Energy increases, particles escape (100¬∞C for water)</div>
                    </div>
                    <div class="sim-formula">
                        <div class="sim-formula-equation">Condensation: Gas ‚Üí Liquid</div>
                        <div class="sim-formula-description">Energy decreases, particles slow down</div>
                    </div>
                    <div class="sim-formula">
                        <div class="sim-formula-equation">Freezing: Liquid ‚Üí Solid</div>
                        <div class="sim-formula-description">Energy decreases, ordered structure forms</div>
                    </div>
                </div>

                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">üìö</span>
                        <span>Key Concepts</span>
                    </div>
                    <ul class="sim-info-list">
                        <li>Solid: Fixed shape, vibrating particles in lattice</li>
                        <li>Liquid: Takes container shape, particles flow freely</li>
                        <li>Gas: Fills entire volume, particles move rapidly</li>
                        <li>Phase changes occur at specific temperatures</li>
                        <li>Higher pressure can change phase transition points</li>
                    </ul>
                </div>

                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">üî¨</span>
                        <span>Try This</span>
                    </div>
                    <ul class="sim-info-list">
                        <li>Slowly heat from -50¬∞C to 150¬∞C - watch transitions</li>
                        <li>Observe particle spacing in each phase</li>
                        <li>See how pressure affects the container volume</li>
                        <li>Compare particle speeds in different phases</li>
                        <li>Try rapid heating vs. slow heating</li>
                    </ul>
                </div>
            </div>

            <div class="sim-sidebar">
                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">‚öôÔ∏è</span>
                        <span>Parameters</span>
                    </div>

                    <div class="sim-control-group">
                        <div class="sim-control-label">
                            <span>Temperature</span>
                            <span class="sim-control-value"><span id="val-temperature">-20</span> ¬∞C</span>
                        </div>
                        <input type="range" id="slider-temperature" min="-50" max="150" value="-20" oninput="updateParameter('temperature', this.value)">
                    </div>

                    <div class="sim-control-group">
                        <div class="sim-control-label">
                            <span>Pressure</span>
                            <span class="sim-control-value"><span id="val-pressure">1.0</span> atm</span>
                        </div>
                        <input type="range" id="slider-pressure" min="0.5" max="3" value="1" step="0.1" oninput="updateParameter('pressure', this.value)">
                    </div>

                    <div class="sim-divider"></div>

                    <div class="sim-toggle">
                        <span>Show Bonds</span>
                        <div class="sim-toggle-switch active" id="toggle-bonds" onclick="toggleBonds()"></div>
                    </div>

                    <div class="sim-toggle">
                        <span>Show Vectors</span>
                        <div class="sim-toggle-switch" id="toggle-vectors" onclick="toggleVectors()"></div>
                    </div>

                    <div class="sim-toggle">
                        <span>Show Grid</span>
                        <div class="sim-toggle-switch" id="toggle-grid" onclick="toggleGrid()"></div>
                    </div>
                </div>
                
                <div class="sim-stats">
                    <div class="sim-stat-card">
                        <div class="sim-stat-value blue" id="stat-phase">SOLID</div>
                        <div class="sim-stat-label">Current Phase</div>
                    </div>
                    <div class="sim-stat-card">
                        <div class="sim-stat-value green" id="stat-particles">100</div>
                        <div class="sim-stat-label">Particles</div>
                    </div>
                    <div class="sim-stat-card">
                        <div class="sim-stat-value purple" id="stat-avgSpeed">0.00</div>
                        <div class="sim-stat-label">Avg Speed</div>
                    </div>
                    <div class="sim-stat-card">
                        <div class="sim-stat-value orange" id="stat-kineticEnergy">0.00</div>
                        <div class="sim-stat-label">Kinetic Energy</div>
                    </div>
                </div>  
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        const MELTING_POINT = 0;
        const BOILING_POINT = 100;
        
        let simState = {
            isRunning: false,
            isPaused: false,
            temperature: -20,
            pressure: 1.0,
            particles: [],
            showBonds: true,
            showVectors: false,
            showGrid: false,
            phase: 'SOLID',
            containerWidth: 600,
            containerHeight: 400,
            containerX: 100,
            containerY: 50
        };

        let animationId = null;

        function init() {
            createParticles();
            updatePhase();
            calculateStats();
            drawCanvas();
        }

        function updateParameter(param, value) {
            document.getElementById(`val-${param}`).textContent = value;
            simState[param] = parseFloat(value);
            
            updatePhase();
            if (param === 'temperature') {
                adjustParticleVelocities();
            }
            
            calculateStats();
            drawCanvas();
        }

        function updatePhase() {
            const adjustedMelting = MELTING_POINT - (simState.pressure - 1) * 2;
            const adjustedBoiling = BOILING_POINT + (simState.pressure - 1) * 10;
            
            if (simState.temperature < adjustedMelting) {
                simState.phase = 'SOLID';
            } else if (simState.temperature < adjustedBoiling) {
                simState.phase = 'LIQUID';
            } else {
                simState.phase = 'GAS';
            }
            
            const indicator = document.getElementById('phaseIndicator');
            indicator.textContent = simState.phase;
            indicator.className = 'phase-indicator phase-' + simState.phase.toLowerCase();
            
            document.getElementById('stat-phase').textContent = simState.phase;
        }

        function toggleBonds() {
            simState.showBonds = !simState.showBonds;
            document.getElementById('toggle-bonds').classList.toggle('active');
            drawCanvas();
        }

        function toggleVectors() {
            simState.showVectors = !simState.showVectors;
            document.getElementById('toggle-vectors').classList.toggle('active');
            drawCanvas();
        }

        function toggleGrid() {
            simState.showGrid = !simState.showGrid;
            document.getElementById('toggle-grid').classList.toggle('active');
            drawCanvas();
        }

        function createParticles() {
            simState.particles = [];
            const numParticles = 100;
            const radius = 5;
            
            if (simState.phase === 'SOLID') {
                const rows = 10;
                const cols = 10;
                const spacingX = simState.containerWidth / (cols + 1);
                const spacingY = simState.containerHeight / (rows + 1);
                
                for (let i = 0; i < rows; i++) {
                    for (let j = 0; j < cols; j++) {
                        const x = simState.containerX + spacingX * (j + 1);
                        const y = simState.containerY + spacingY * (i + 1);
                        const baseX = x;
                        const baseY = y;
                        
                        simState.particles.push({
                            x, y, baseX, baseY,
                            vx: 0, vy: 0,
                            radius
                        });
                    }
                }
            } else {
                for (let i = 0; i < numParticles; i++) {
                    simState.particles.push({
                        x: simState.containerX + radius + Math.random() * (simState.containerWidth - 2 * radius),
                        y: simState.containerY + radius + Math.random() * (simState.containerHeight - 2 * radius),
                        vx: 0, vy: 0,
                        baseX: 0, baseY: 0,
                        radius
                    });
                }
            }
            
            adjustParticleVelocities();
        }

        function adjustParticleVelocities() {
            const tempK = simState.temperature + 273.15;
            const baseSolidVibration = 0.3;
            const baseLiquidSpeed = 2;
            const baseGasSpeed = 4;
            
            if (simState.phase === 'SOLID') {
                const vibrationIntensity = baseSolidVibration * Math.sqrt(Math.max(tempK / 273.15, 0.1));
                for (let p of simState.particles) {
                    const angle = Math.random() * Math.PI * 2;
                    p.vx = Math.cos(angle) * vibrationIntensity;
                    p.vy = Math.sin(angle) * vibrationIntensity;
                }
            } else if (simState.phase === 'LIQUID') {
                const tempRatio = (simState.temperature - MELTING_POINT) / (BOILING_POINT - MELTING_POINT);
                const speed = baseLiquidSpeed * (0.5 + tempRatio);
                
                for (let p of simState.particles) {
                    const angle = Math.random() * Math.PI * 2;
                    const speedVar = 0.5 + Math.random();
                    p.vx = Math.cos(angle) * speed * speedVar;
                    p.vy = Math.sin(angle) * speed * speedVar;
                }
            } else {
                const tempRatio = Math.max((simState.temperature - BOILING_POINT) / 50, 1);
                const speed = baseGasSpeed * tempRatio;
                
                for (let p of simState.particles) {
                    const angle = Math.random() * Math.PI * 2;
                    const speedVar = 0.5 + Math.random();
                    p.vx = Math.cos(angle) * speed * speedVar;
                    p.vy = Math.sin(angle) * speed * speedVar;
                }
            }
        }

        function startSimulation() {
            if (simState.particles.length === 0) createParticles();
            simState.isRunning = true;
            simState.isPaused = false;
            animate();
        }

        function pauseSimulation() {
            simState.isPaused = !simState.isPaused;
            const btn = document.getElementById('pauseBtn');
            
            if (simState.isPaused) {
                btn.textContent = '‚ñ∂Ô∏è Play';
                cancelAnimationFrame(animationId);
            } else {
                btn.textContent = '‚è∏Ô∏è Pause';
                animate();
            }
        }

        function resetSimulation() {
            simState.isRunning = false;
            simState.isPaused = false;
            cancelAnimationFrame(animationId);
            
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';
            
            createParticles();
            calculateStats();
            drawCanvas();
        }

        function animate() {
            if (!simState.isRunning || simState.isPaused) return;
            
            updateParticles();
            calculateStats();
            drawCanvas();
            
            animationId = requestAnimationFrame(animate);
        }

        function updateParticles() {
            if (simState.phase === 'SOLID') {
                for (let p of simState.particles) {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    const dx = p.x - p.baseX;
                    const dy = p.y - p.baseY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist > 15) {
                        const restoreForce = 0.1;
                        p.vx -= dx * restoreForce;
                        p.vy -= dy * restoreForce;
                    }
                    
                    p.vx *= 0.95;
                    p.vy *= 0.95;
                    
                    const angle = Math.random() * Math.PI * 2;
                    const vibration = 0.05;
                    p.vx += Math.cos(angle) * vibration;
                    p.vy += Math.sin(angle) * vibration;
                }
            } else {
                for (let p of simState.particles) {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if (p.x - p.radius <= simState.containerX || 
                        p.x + p.radius >= simState.containerX + simState.containerWidth) {
                        p.vx *= -1;
                        p.x = Math.max(simState.containerX + p.radius, 
                                      Math.min(p.x, simState.containerX + simState.containerWidth - p.radius));
                    }
                    
                    if (p.y - p.radius <= simState.containerY || 
                        p.y + p.radius >= simState.containerY + simState.containerHeight) {
                        p.vy *= -1;
                        p.y = Math.max(simState.containerY + p.radius, 
                                      Math.min(p.y, simState.containerY + simState.containerHeight - p.radius));
                    }
                }
                
                for (let i = 0; i < simState.particles.length; i++) {
                    for (let j = i + 1; j < simState.particles.length; j++) {
                        const p1 = simState.particles[i];
                        const p2 = simState.particles[j];
                        const dx = p2.x - p1.x;
                        const dy = p2.y - p1.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < p1.radius + p2.radius) {
                            const angle = Math.atan2(dy, dx);
                            const sin = Math.sin(angle);
                            const cos = Math.cos(angle);
                            
                            const vx1 = p1.vx * cos + p1.vy * sin;
                            const vy1 = p1.vy * cos - p1.vx * sin;
                            const vx2 = p2.vx * cos + p2.vy * sin;
                            const vy2 = p2.vy * cos - p2.vx * sin;
                            
                            p1.vx = vx2 * cos - vy1 * sin;
                            p1.vy = vy1 * cos + vx2 * sin;
                            p2.vx = vx1 * cos - vy2 * sin;
                            p2.vy = vy2 * cos + vx1 * sin;
                            
                            const overlap = p1.radius + p2.radius - dist;
                            const moveX = overlap * cos / 2;
                            const moveY = overlap * sin / 2;
                            p1.x -= moveX;
                            p1.y -= moveY;
                            p2.x += moveX;
                            p2.y += moveY;
                        }
                    }
                }
            }
        }

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (simState.showGrid) {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                ctx.lineWidth = 1;
                for (let i = 0; i < canvas.width; i += 50) {
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvas.height);
                    ctx.stroke();
                }
                for (let i = 0; i < canvas.height; i += 50) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvas.width, i);
                    ctx.stroke();
                }
            }
            
            ctx.strokeStyle = '#6b9eff';
            ctx.lineWidth = 3;
            ctx.strokeRect(simState.containerX, simState.containerY, 
                          simState.containerWidth, simState.containerHeight);
            
            let bgAlpha;
            if (simState.phase === 'SOLID') bgAlpha = 0.15;
            else if (simState.phase === 'LIQUID') bgAlpha = 0.08;
            else bgAlpha = 0.02;
            
            ctx.fillStyle = `rgba(107, 158, 255, ${bgAlpha})`;
            ctx.fillRect(simState.containerX, simState.containerY, 
                        simState.containerWidth, simState.containerHeight);
            
            if (simState.showBonds && simState.phase === 'SOLID') {
                ctx.strokeStyle = 'rgba(107, 158, 255, 0.3)';
                ctx.lineWidth = 1;
                for (let i = 0; i < simState.particles.length; i++) {
                    const p1 = simState.particles[i];
                    for (let j = i + 1; j < simState.particles.length; j++) {
                        const p2 = simState.particles[j];
                        const dx = p2.x - p1.x;
                        const dy = p2.y - p1.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < 80) {
                            ctx.beginPath();
                            ctx.moveTo(p1.x, p1.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.stroke();
                        }
                    }
                }
            }
            
            for (let p of simState.particles) {
                let color;
                if (simState.phase === 'SOLID') {
                    color = '#6b9eff';
                } else if (simState.phase === 'LIQUID') {
                    color = '#6bffb9';
                } else {
                    color = '#ff6b6b';
                }
                
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
                
                if (simState.showVectors && (p.vx !== 0 || p.vy !== 0)) {
                    ctx.strokeStyle = 'rgba(255, 235, 107, 0.8)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p.x + p.vx * 8, p.y + p.vy * 8);
                    ctx.stroke();
                    
                    const arrowX = p.x + p.vx * 8;
                    const arrowY = p.y + p.vy * 8;
                    const angle = Math.atan2(p.vy, p.vx);
                    
                    ctx.beginPath();
                    ctx.moveTo(arrowX, arrowY);
                    ctx.lineTo(
                        arrowX - 5 * Math.cos(angle - Math.PI / 6),
                        arrowY - 5 * Math.sin(angle - Math.PI / 6)
                    );
                    ctx.moveTo(arrowX, arrowY);
                    ctx.lineTo(
                        arrowX - 5 * Math.cos(angle + Math.PI / 6),
                        arrowY - 5 * Math.sin(angle + Math.PI / 6)
                    );
                    ctx.stroke();
                }
            }
        }

        function calculateStats() {
            let totalSpeed = 0;
            for (let p of simState.particles) {
                totalSpeed += Math.sqrt(p.vx * p.vx + p.vy * p.vy);
            }
            const avgSpeed = totalSpeed / simState.particles.length;
            
            const tempK = simState.temperature + 273.15;
            const kineticEnergy = 1.5 * 1.38e-23 * tempK * simState.particles.length;
            
            document.getElementById('stat-particles').textContent = simState.particles.length;
            document.getElementById('stat-avgSpeed').textContent = avgSpeed.toFixed(2);
            document.getElementById('stat-kineticEnergy').textContent = (kineticEnergy * 1e21).toFixed(2);
        }

        init();
    </script>
</body>
</html>