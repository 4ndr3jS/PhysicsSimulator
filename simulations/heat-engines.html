<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Engine - Physics Simulator</title>
    <link rel="stylesheet" href="simulations.css">
</head>
<body>
    <nav>
        <a href="index.html">Physics Simulator</a>
        <ul>
            <a href="../index.html">Home</a>
            <a href="../simulations.html">Simulations</a>
            <a href="../guide.html">Guide</a>
            <a href="../theory.html">Theory</a>
            <a href="../learn.html">Learn Physics</a>
        </ul>
    </nav>

    <div class="sim-container">
        <div class="sim-header">
            <h1>üî• Heat Engine Simulator</h1>
            <p>Explore thermodynamic cycles and energy conversion from heat to work</p>
            <p class="sim-subtitle">Difficulty: <span class="sim-badge sim-badge-medium">‚óè Medium</span></p>
        </div>

        <div class="sim-layout">
            <div class="sim-canvas-section">
                <div class="sim-canvas-wrapper">
                    <canvas id="simCanvas" class="sim-canvas" width="800" height="500"></canvas>
                    
                    <div class="sim-controls">
                        <button class="sim-btn sim-btn-primary" onclick="startEngine()" id="startBtn">‚ñ∂Ô∏è Start Engine</button>
                        <button class="sim-btn sim-btn-secondary" onclick="pauseSimulation()" id="pauseBtn">‚è∏Ô∏è Pause</button>
                        <button class="sim-btn sim-btn-secondary" onclick="resetSimulation()">üîÑ Reset</button>
                    </div>
                </div>

                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">üìê</span>
                        <span>Thermodynamic Formulas</span>
                    </div>
                    <div class="sim-formula">
                        <div class="sim-formula-equation">Œ∑ = W / Q<sub>H</sub> = 1 - Q<sub>C</sub>/Q<sub>H</sub></div>
                        <div class="sim-formula-description">Engine efficiency</div>
                    </div>
                    <div class="sim-formula">
                        <div class="sim-formula-equation">Œ∑<sub>Carnot</sub> = 1 - T<sub>C</sub>/T<sub>H</sub></div>
                        <div class="sim-formula-description">Maximum theoretical efficiency</div>
                    </div>
                    <div class="sim-formula">
                        <div class="sim-formula-equation">W = Q<sub>H</sub> - Q<sub>C</sub></div>
                        <div class="sim-formula-description">Work output</div>
                    </div>
                </div>

                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">üìö</span>
                        <span>Key Concepts</span>
                    </div>
                    <ul class="sim-info-list">
                        <li>Heat engines convert thermal energy to mechanical work</li>
                        <li>No engine can be 100% efficient (2nd Law)</li>
                        <li>Carnot cycle represents maximum efficiency</li>
                        <li>Higher temperature difference = higher efficiency</li>
                        <li>Some heat must always be rejected to cold reservoir</li>
                    </ul>
                </div>

                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">üî¨</span>
                        <span>Try This</span>
                    </div>
                    <ul class="sim-info-list">
                        <li>Maximize hot temperature - what happens to efficiency?</li>
                        <li>Try equal hot and cold temps - any work output?</li>
                        <li>Compare Carnot vs Otto cycle efficiency</li>
                        <li>Increase compression ratio for Otto cycle</li>
                        <li>Find optimal settings for maximum power output</li>
                    </ul>
                </div>
            </div>

            <div class="sim-sidebar">
                <div class="sim-panel">
                    <div class="sim-panel-header">
                        <span class="sim-panel-icon">‚öôÔ∏è</span>
                        <span>Parameters</span>
                    </div>

                    <div class="sim-control-group">
                        <div class="sim-control-label">
                            <span>Cycle Type</span>
                        </div>
                        <div class="cycle-toggle">
                            <button 
                                class="cycle-btn active" 
                                data-cycle="carnot"
                                onclick="setCycle(this)">
                                Carnot
                            </button>
                            <button 
                                class="cycle-btn" 
                                data-cycle="otto"
                                onclick="setCycle(this)">
                                Otto
                            </button>
                        </div>
                    </div>

                    <div class="sim-control-group">
                        <div class="sim-control-label">
                            <span>Hot Temperature (T<sub>H</sub>)</span>
                            <span class="sim-control-value"><span id="val-hotTemp">600</span> K</span>
                        </div>
                        <input type="range" id="slider-hotTemp" min="400" max="1000" value="600" oninput="updateParameter('hotTemp', this.value)">
                    </div>

                    <div class="sim-control-group">
                        <div class="sim-control-label">
                            <span>Cold Temperature (T<sub>C</sub>)</span>
                            <span class="sim-control-value"><span id="val-coldTemp">300</span> K</span>
                        </div>
                        <input type="range" id="slider-coldTemp" min="200" max="500" value="300" oninput="updateParameter('coldTemp', this.value)">
                    </div>

                    <div class="sim-control-group" id="compressionGroup">
                        <div class="sim-control-label">
                            <span>Compression Ratio</span>
                            <span class="sim-control-value"><span id="val-compression">8</span>:1</span>
                        </div>
                        <input type="range" id="slider-compression" min="4" max="12" value="8" oninput="updateParameter('compression', this.value)">
                    </div>

                    <div class="sim-control-group">
                        <div class="sim-control-label">
                            <span>Engine Speed</span>
                            <span class="sim-control-value"><span id="val-speed">1.0</span>x</span>
                        </div>
                        <input type="range" id="slider-speed" min="0.5" max="3" value="1.0" step="0.1" oninput="updateParameter('speed', this.value)">
                    </div>

                    <div class="sim-divider"></div>

                    <div class="sim-toggle">
                        <span>Show PV Diagram</span>
                        <div class="sim-toggle-switch active" id="toggle-pv" onclick="togglePV()"></div>
                    </div>

                    <div class="sim-toggle">
                        <span>Show Labels</span>
                        <div class="sim-toggle-switch active" id="toggle-labels" onclick="toggleLabels()"></div>
                    </div>
                </div>

                <div class="sim-stats">
                    <div class="sim-stat-card">
                        <div class="sim-stat-value blue" id="stat-efficiency">0.0</div>
                        <div class="sim-stat-label">Efficiency (%)</div>
                    </div>
                    <div class="sim-stat-card">
                        <div class="sim-stat-value green" id="stat-work">0.0</div>
                        <div class="sim-stat-label">Work Output (J)</div>
                    </div>
                    <div class="sim-stat-card">
                        <div class="sim-stat-value orange" id="stat-qh">0.0</div>
                        <div class="sim-stat-label">Heat In (J)</div>
                    </div>
                    <div class="sim-stat-card">
                        <div class="sim-stat-value purple" id="stat-qc">0.0</div>
                        <div class="sim-stat-label">Heat Out (J)</div>
                    </div>
                    <div class="sim-stat-card">
                        <div class="sim-stat-value red" id="stat-carnot">50.0</div>
                        <div class="sim-stat-label">Carnot Max (%)</div>
                    </div>
                </div>  
            </div>
        </div>
    </div>
        <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        let simState = {
            isRunning: false,
            isPaused: false,
            cycleType: 'carnot',
            hotTemp: 600,
            coldTemp: 300,
            compression: 8,
            speed: 1.0,
            phase: 0,
            time: 0,
            showPV: true,
            showLabels: true,
            pistonPos: 0,
            particles: []
        };

        let animationId = null;

        function init() {
            generateParticles();
            calculateStats();
            drawCanvas();
        }

        function generateParticles() {
            simState.particles = [];
            for (let i = 0; i < 40; i++) {
                simState.particles.push({
                    x: Math.random() * 180 + 60,
                    y: Math.random() * 200 + 150,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2
                });
            }
        }

        function updateParameter(param, value) {
            document.getElementById(`val-${param}`).textContent = value;
            simState[param] = parseFloat(value);
            calculateStats();
            if (!simState.isRunning) drawCanvas();
        }

        function changeCycle(type) {
            simState.cycleType = type;
            const compressionGroup = document.getElementById('compressionGroup');
            compressionGroup.style.display = type === 'otto' ? 'block' : 'none';
            calculateStats();
            if (!simState.isRunning) drawCanvas();
        }

        function togglePV() {
            simState.showPV = !simState.showPV;
            document.getElementById('toggle-pv').classList.toggle('active');
            drawCanvas();
        }

        function toggleLabels() {
            simState.showLabels = !simState.showLabels;
            document.getElementById('toggle-labels').classList.toggle('active');
            drawCanvas();
        }

        function startEngine() {
            simState.isRunning = true;
            simState.isPaused = false;
            document.getElementById('startBtn').textContent = '‚èπÔ∏è Stop Engine';
            document.getElementById('startBtn').onclick = stopEngine;
            animate();
        }

        function stopEngine() {
            simState.isRunning = false;
            simState.isPaused = false;
            simState.phase = 0;
            simState.time = 0;
            cancelAnimationFrame(animationId);
            document.getElementById('startBtn').textContent = '‚ñ∂Ô∏è Start Engine';
            document.getElementById('startBtn').onclick = startEngine;
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';
            drawCanvas();
        }

        function pauseSimulation() {
            if (!simState.isRunning) return;
            simState.isPaused = !simState.isPaused;
            const btn = document.getElementById('pauseBtn');
            
            if (simState.isPaused) {
                btn.textContent = '‚ñ∂Ô∏è Play';
                cancelAnimationFrame(animationId);
            } else {
                btn.textContent = '‚è∏Ô∏è Pause';
                animate();
            }
        }

        function resetSimulation() {
            stopEngine();
            simState.phase = 0;
            simState.time = 0;
            simState.pistonPos = 0;
            generateParticles();
            drawCanvas();
        }

        function animate() {
            if (!simState.isRunning || simState.isPaused) return;
            
            simState.time += 0.02 * simState.speed;
            simState.phase = (simState.time % 4);
            
            const cycleProgress = (simState.time % 4) / 4;
            simState.pistonPos = Math.sin(cycleProgress * Math.PI * 2) * 60 + 60;
            
            updateParticles();
            drawCanvas();
            
            animationId = requestAnimationFrame(animate);
        }

        function updateParticles() {
            const temp = getCurrentTemp();
            const speedFactor = Math.sqrt(temp / 300);
            const bounds = { left: 60, right: 240 - simState.pistonPos, top: 150, bottom: 350 };
            
            simState.particles.forEach(p => {
                p.x += p.vx * speedFactor;
                p.y += p.vy * speedFactor;
                
                if (p.x < bounds.left || p.x > bounds.right) {
                    p.vx *= -1;
                    p.x = Math.max(bounds.left, Math.min(bounds.right, p.x));
                }
                if (p.y < bounds.top || p.y > bounds.bottom) {
                    p.vy *= -1;
                    p.y = Math.max(bounds.top, Math.min(bounds.bottom, p.y));
                }
            });
        }

        function getCurrentTemp() {
            const phase = simState.phase;
            if (phase < 1) return simState.coldTemp + (simState.hotTemp - simState.coldTemp) * phase;
            if (phase < 2) return simState.hotTemp;
            if (phase < 3) return simState.hotTemp - (simState.hotTemp - simState.coldTemp) * (phase - 2);
            return simState.coldTemp;
        }

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawCylinder();
            drawParticles();
            drawPiston();
            
            if (simState.showPV) {
                drawPVDiagram();
            }
            
            if (simState.showLabels) {
                drawLabels();
            }
        }

        function drawCylinder() {
            ctx.fillStyle = '#1a1a2e';
            ctx.strokeStyle = '#6b9eff';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            ctx.rect(60, 150, 180, 200);
            ctx.fill();
            ctx.stroke();
            
            ctx.fillStyle = '#2a2a4a';
            ctx.fillRect(60, 140, 180, 10);
        }

        function drawPiston() {
            const pistonX = 240 - simState.pistonPos;
            
            ctx.fillStyle = '#4a4a6a';
            ctx.fillRect(pistonX - 10, 150, 10, 200);
            
            ctx.strokeStyle = '#8b8baa';
            ctx.lineWidth = 2;
            ctx.strokeRect(pistonX - 10, 150, 10, 200);
            
            ctx.fillStyle = '#6a6a8a';
            ctx.beginPath();
            ctx.moveTo(pistonX, 200);
            ctx.lineTo(pistonX + 60, 200);
            ctx.lineTo(pistonX + 60, 300);
            ctx.lineTo(pistonX, 300);
            ctx.fill();
            ctx.stroke();
        }

        function drawParticles() {
            const temp = getCurrentTemp();
            const hue = ((temp - 200) / 800) * 60;
            ctx.fillStyle = `hsl(${hue}, 70%, 60%)`;
            
            simState.particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawPVDiagram() {
            const pvX = 500;
            const pvY = 100;
            const pvWidth = 250;
            const pvHeight = 250;
            
            ctx.strokeStyle = '#4a4a6a';
            ctx.lineWidth = 2;
            ctx.strokeRect(pvX, pvY, pvWidth, pvHeight);
            
            ctx.fillStyle = '#ffffff';
            ctx.font = '14px Arial';
            ctx.fillText('P-V Diagram', pvX + 10, pvY - 10);
            ctx.fillText('P', pvX - 20, pvY + 10);
            ctx.fillText('V', pvX + pvWidth - 10, pvY + pvHeight + 20);
            
            ctx.strokeStyle = '#6b9eff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const points = 100;
            for (let i = 0; i <= points; i++) {
                const t = i / points;
                const {p, v} = getCyclePoint(t);
                const x = pvX + v * pvWidth;
                const y = pvY + pvHeight - p * pvHeight;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            if (simState.isRunning) {
                const cycleProgress = (simState.time % 4) / 4;
                const {p, v} = getCyclePoint(cycleProgress);
                const x = pvX + v * pvWidth;
                const y = pvY + pvHeight - p * pvHeight;
                
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function getCyclePoint(t) {
            if (simState.cycleType === 'carnot') {
                const gamma = 1.4;
                
                if (t < 0.25) {

                    const progress = t * 4;
                    const v = 0.2 + progress * 0.4;
                    const p = 0.85 - progress * 0.05;
                    return {p, v};
                } else if (t < 0.5) {
                    
                    const progress = (t - 0.25) * 4;
                    const v = 0.6 + progress * 0.2;
                    const p = 0.80 * Math.pow((1 - progress), 1.8);
                    return {p: p * 0.5 + 0.25, v};
                } else if (t < 0.75) {
                    
                    const progress = (t - 0.5) * 4;
                    const v = 0.8 - progress * 0.4;
                    const p = 0.25 + progress * 0.05;
                    return {p, v};
                } else {
                    
                    const progress = (t - 0.75) * 4;
                    const v = 0.4 - progress * 0.2;
                    const p = 0.30 + Math.pow(progress, 0.7) * 0.55;
                    return {p, v};
                }
            } else {
                if (t < 0.25) {
                    const v = 0.7 - t * 4 * 0.4;
                    const p = 0.2 + t * 4 * 0.6;
                    return {p, v};
                } else if (t < 0.5) {
                    const v = 0.3;
                    const p = 0.8;
                    return {p, v};
                } else if (t < 0.75) {
                    const v = 0.3 + (t - 0.5) * 4 * 0.4;
                    const p = 0.8 - (t - 0.5) * 4 * 0.6;
                    return {p, v};
                } else {
                    const v = 0.7;
                    const p = 0.2;
                    return {p, v};
                }
            }
        }

        function drawLabels() {
            ctx.fillStyle = '#ffffff';
            ctx.font = '16px Arial';
            
            ctx.fillText('üî• Hot Reservoir', 280, 30);
            ctx.fillText(`${simState.hotTemp} K`, 280, 50);
            
            ctx.fillText('‚ùÑÔ∏è Cold Reservoir', 280, 470);
            ctx.fillText(`${simState.coldTemp} K`, 280, 490);
            
            const temp = getCurrentTemp();
            ctx.fillText(`Cylinder: ${temp.toFixed(0)} K`, 80, 130);
            
            const phaseNames = ['Compression', 'Heat Addition', 'Expansion', 'Heat Rejection'];
            const phaseIndex = Math.floor(simState.phase);
            if (simState.isRunning) {
                ctx.fillText(`Phase: ${phaseNames[phaseIndex]}`, 280, 100);
            }
        }

        function calculateStats() {
            const carnotEff = (1 - simState.coldTemp / simState.hotTemp) * 100;
            
            let actualEff;
            if (simState.cycleType === 'carnot') {
                actualEff = carnotEff * 0.95;
            } else {
                const gamma = 1.4;
                const r = simState.compression;
                actualEff = (1 - 1 / Math.pow(r, gamma - 1)) * 100;
            }
            
            const Qh = 1000;
            const W = Qh * actualEff / 100;
            const Qc = Qh - W;
            
            document.getElementById('stat-efficiency').textContent = actualEff.toFixed(1);
            document.getElementById('stat-work').textContent = W.toFixed(1);
            document.getElementById('stat-qh').textContent = Qh.toFixed(1);
            document.getElementById('stat-qc').textContent = Qc.toFixed(1);
            document.getElementById('stat-carnot').textContent = carnotEff.toFixed(1);
        }

        changeCycle('carnot');
        init();

        function setCycle(btn){
            const cycle = btn.dataset.cycle;

            document.querySelectorAll('.cycle-btn')
                .forEach(b => b.classList.remove('active'));

            btn.classList.add('active');
            changeCycle(cycle);
        }
    </script>
</body>
</html>